<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"><head>
<title>Consultant Join</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    function validateImage(input) {
        const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
        const file = input.files[0];

        if (file && allowedTypes.includes(file.type)) {
            if (file.size > 10 * 1024 * 1024) {
                alert('이미지 파일 크기는 10MB를 초과할 수 없습니다.');
                input.value = '';
                return false;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                $('#imagePreview').attr('src', e.target.result);
            }
            reader.readAsDataURL(file);
        } else {
            alert('이미지 파일만 업로드 가능합니다 (JPEG, PNG, GIF).');
            input.value = '';
            return false;
        }
        return true;
    }
</script>
    <style>
        .img-preview {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            display: block;
            margin: 0 auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h2 class="mb-4">Consultant Join</h2>
    <form th:action="@{/consultant/join}" method="post" th:object="${consultantJoinDTO}" enctype="multipart/form-data">
        <!-- 중복체크 없을 경우 submit X -->
        <input type="hidden" id="isUsernameChecked" value="false">

        <div class="text-center mb-4">
            <img id="imagePreview" src="/img/member/member-default.png" alt="Image Preview" class="img-preview mb-3" />
            <input type="file" class="form-control-file" id="imageUpload" name="image" accept="image/*" onchange="validateImage(this)" style="display: none;">
            <button type="button" class="btn btn-outline-info" onclick="document.getElementById('imageUpload').click();">이미지 선택</button>
        </div>

        <div class="form-group">
            <label for="username">아이디</label>
            <input type="text" class="form-control" id="username" th:field="*{username}">
            <small th:if="${usernameError != null}" th:text="${usernameError}" class="text-danger"></small>
        </div>
        <div class="form-group">
            <label for="password">비밀번호</label>
            <input type="password" class="form-control" id="password" th:field="*{password}">
            <small th:if="${passwordError != null}" th:text="${passwordError}" class="text-danger"></small>
        </div>
        <div class="form-group">
            <label for="confirmPassword">비밀번호 확인</label>
            <input type="password" class="form-control" id="confirmPassword" th:field="*{confirmPassword}">
            <small th:if="${confirmPasswordError != null}" th:text="${confirmPasswordError}" class="text-danger"></small>
        </div>
        <div class="form-group">
            <label for="name">이름</label>
            <input type="text" class="form-control" id="name" th:field="*{name}">
            <small th:if="${nameError != null}" th:text="${nameError}" class="text-danger"></small>
        </div>
        <div class="form-group">
            <label for="subject">담당 과목</label>
            <input type="text" class="form-control" id="subject" th:field="*{subject}">
            <small th:if="${subjectError != null}" th:text="${subjectError}" class="text-danger"></small>
        </div>
        <div class="form-group">
            <label for="description">설명</label>
            <textarea class="form-control" id="description" th:field="*{description}"></textarea>
            <small th:if="${descriptionError != null}" th:text="${descriptionError}" class="text-danger"></small>
        </div>

        <div class="form-group">
            <button type="submit" class="btn btn-primary">가입</button>
        </div>
        <div th:if="${error != null}" class="alert alert-danger" th:text="${error}"></div>
    </form>
</div>
</body>
</html>